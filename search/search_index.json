{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Creaci\u00f3n y configuraci\u00f3n de un certificado SSL/TLS autofirmado en Apche","text":""},{"location":"#creacion-del-certificado-autofirmado","title":"Creaci\u00f3n del certificado autofirmado","text":"<p>Para crear el certificado autofirmado utilidadopenssl usaremos el siguiente comando: </p> <pre><code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt\n</code></pre> <p>Introducimos unos datos que se a\u00f1adir\u00e1n al certificado. En mi caso he a\u00f1adido los siguientes: </p>"},{"location":"#automatizar-la-creacion-de-un-certificado-autofirmado","title":"Automatizar la creaci\u00f3n de un certificado autofirmado","text":"<p>Crearemos un script bash donde especificaremos los argumentos que le pasaremos al comando anterior a trav\u00e9s del par\u00e1metro -subj.</p> <pre><code>#!/bin/bash\nset -x\n\n# Variables con los datos del certificado\nOPENSSL_COUNTRY=\"ES\"\nOPENSSL_PROVINCE=\"Valencia\"\nOPENSSL_LOCALITY=\"Gandia\"\nOPENSSL_ORGANIZATION=\"IES Jaume II el Just\"\nOPENSSL_ORGUNIT=\"Departamento de Informatica\"\nOPENSSL_COMMON_NAME=\"practica-certificado.local\"\nOPENSSL_EMAIL=\"marina@ieseljust.com\"\n\n# Creaci\u00f3n del certificado\nsudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt -subj \"/C=$OPENSSL_COUNTRY/ST=$OPENSSL_PROVINCE/L=$OPENSSL_LOCALITY/O=$OPENSSL_ORGANIZATION/OU=$OPENSSL_ORGUNIT/CN=$OPENSSL_COMMON_NAME/emailAddress=$OPENSSL_EMAIL\"\n\n</code></pre> <p></p>"},{"location":"#script","title":"Script","text":"<p>Puedes descargar el script haciendo clic en el siguiente bot\u00f3n:</p> <p>Descargar Script</p>"},{"location":"#configuracion-del-host-virtual-con-ssltsl-en-el-servidor-apache","title":"Configuraci\u00f3n del host virtual con SSL/TSL en el servidor Apache","text":"<p>Copiamos el archivo \"default-ssl.conf\", que es la configuraci\u00f3n del VirtualHost, donde habilitaremos el tr\u00e1fico http y lo editamos.</p> <ul> <li>sudo cd /et/apache2/sites-available</li> <li>sudo cp default-ssl.conf certificado-ssl.conf </li> <li>sudo nano certificado-ssl.conf</li> </ul> <pre><code>&lt;VirtualHost *:443&gt;\n    #ServerName practica-certificado.local\n    DocumentRoot/var/www/html\n    DirectoryIndex index.php index.html\n    SSLEngine on\n    SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt\n    SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key\n&lt;/VirtualHost&gt;\n</code></pre> <ol> <li> <p>Habilitaremos el VirtualHost que acabamos de configurar</p> <ul> <li>sudo a2ensite certificado-ssl.conf </li> </ul> </li> <li> <p>Habilitaremos el m\u00f3dulo SSL en Apache y reiniciaremos el servicio</p> <ul> <li>sudo a2enmod ssl</li> <li> <p>sudo systemctl restart apache2 </p> </li> <li> <p>sudo systemctl status apache2 </p> </li> </ul> </li> <li> <p>Copiamos y editamos el VirtualHost de HTTP para que redirija todo el tr\u00e1fico a HTTPS</p> <ul> <li>sudo cd /et/apache2/sites-available</li> <li>sudo cp 000-default-ssl.conf 000-certificado-ssl.conf </li> <li>sudo nano 000-certificado-ssl.conf</li> </ul> </li> </ol> <pre><code>    &lt;VirtualHost *:80&gt;\n        #ServerName practica-certificado.local\n        DocumentRoot/var/www/html\n        #Redirige alpuerto 443 (HTTPS)\n        RewriteEngineOn\n        RewriteCond%{HTTPS} off\n        RewriteRule^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]\n    &lt;/VirtualHost&gt;\n</code></pre> <ol> <li> <p>Habilitaremos el m\u00f3dulo rewrite y reiniciamos en servicio</p> <ul> <li>sudo a2enmod rewrite</li> <li> <p>sudo systemctl restart apache2 </p> </li> <li> <p>sudo systemctl status apache2 </p> </li> </ul> </li> <li> <p>Nos aseguramos de que el puerto 443 est\u00e9 abierto en las reglas del firewall para permitir  el trafico hhtps. </p> </li> <li> <p>Modificamos el fichero /etc/hosts</p> <ul> <li>sudo nano /etc/hosts</li> </ul> </li> </ol> <p></p> <p>Una vez hecho todo esto, abriremos un navegador y accederemos al nombre de nuestro dominio. En mi caso ser\u00e1:</p> <pre><code>https://practica-certificado.local\n</code></pre>"}]}